<div class="page">
  <header>
    <div class="header-esquerda">
      <button class="menu-btn" (click)="toggleMenu()">â˜°</button>

      <div class="busca-container">
        <input type="text" id="campoBusca" placeholder="Buscar mangÃ¡..." [(ngModel)]="termo" (input)="onBuscar()" />
        <div id="resultadosBusca" [class.mostrar]="resultadosVisiveis">
          <div *ngFor="let r of resultados" (click)="abrirManga(r.id)">
            <strong>{{ r.nome }}</strong><br />
            <small>{{ r.autor || 'Autor desconhecido' }}</small>
          </div>
          <div *ngIf="resultados.length === 0 && resultadosVisiveis">Nenhum mangÃ¡ encontrado.</div>
        </div>
      </div>
    </div>

    <div class="header-centro">
      <img src="assets/logo.png" alt="Toon Archive" class="logo" />
    </div>

    <div class="header-direita" style="position: relative;">
      <button id="usuarioBtn" class="usuario-btn" (click)="onUsuarioClick($event)">ğŸ‘¤</button>
      <div id="menuUsuario" class="menu-usuario" [class.ativo]="menuUsuarioAtivo" (click)="$event.stopPropagation()">
        <p id="usuarioNome">{{ apelido || '' }}</p>
        <button id="logoutBtn" (click)="abrirLogout()">Sair</button>
      </div>
    </div>
  </header>

  <nav id="menu-lateral" class="menu-lateral" [class.ativo]="menuAtivo">
    <ul>
      <li><button (click)="ir('/publicar-obra')">ğŸ“– PublicaÃ§Ã£o</button></li>
      <li><button>ğŸŒ Idioma</button></li>
      <li><button (click)="ir('/comunidade')">ğŸ’¬ Comunidade</button></li>
    </ul>
  </nav>
  <div id="overlay" [class.ativo]="overlayAtivo" (click)="fecharMenu()"></div>

  <div class="banner-carousel" *ngIf="carrossel.length > 0">
    <div class="banner-slides" [style.transform]="'translateX(-' + slideAtual * 100 + '%)'">

      <!-- UM SLIDE PARA CADA OBRA -->
      <div class="banner-slide" *ngFor="let m of carrossel" (click)="abrirManga(m.id)">
        <img [src]="m.capa ? API_BASE + m.capa : 'assets/placeholder.png'" />
      </div>

    </div>

    <!-- INDICADORES -->
    <div class="banner-indicators">
      <span class="dot" *ngFor="let m of carrossel; let i = index" [class.active]="slideAtual === i"
        (click)="goToSlide(i)">
      </span>
    </div>
  </div>

  <section class="catalogo">
    <h2>ğŸ“¢ RecÃ©m-lanÃ§ados:</h2>
    <div class="recentes-container">
      <button class="seta seta-esquerda" (click)="rolar('recentes', -1)">&#10094;</button>
      <div id="recentes" class="mangas">
        <div class="manga-card" *ngFor="let m of recentes" (click)="abrirManga(m.id)">
          <img [src]="m.capa ? API_BASE + m.capa : 'assets/placeholder.png'" />
          <p>{{ m.nome || 'Sem tÃ­tulo' }}</p>
        </div>
        <p *ngIf="erroRecentes" style="color:#fff">Erro ao carregar obras.</p>
      </div>
      <button class="seta seta-direita" (click)="rolar('recentes', 1)">&#10095;</button>
    </div>

    <h2>ğŸ”¥ Destaques:</h2>
    <div class="destaques-container">
      <button class="seta seta-esquerda" (click)="rolar('destaques', -1)">&#10094;</button>

      <div id="destaques" class="mangas">
        <div class="manga-card" *ngFor="let d of destaques" (click)="abrirManga(d.id)"
          title="{{ d.nome || 'Sem tÃ­tulo' }}">
          <img [src]="d.capa ? (API_BASE + d.capa) : 'assets/placeholder.png'" alt="{{ d.nome || 'Capa' }}" />
          <p>{{ d.nome || 'Sem tÃ­tulo' }}</p>
        </div>

        <p *ngIf="erroDestaques" style="color:#fff">Erro ao carregar destaques.</p>
        <p *ngIf="!erroDestaques && destaques?.length === 0" style="color:#fff">Ainda nÃ£o hÃ¡ destaques.</p>
      </div>

      <button class="seta seta-direita" (click)="rolar('destaques', 1)">&#10095;</button>
    </div>

    <h2>â­ Favoritos:</h2>
    <div class="favoritos-container">
      <button class="seta seta-esquerda" (click)="rolar('favoritos', -1)">&#10094;</button>

      <div id="favoritos" class="mangas">
        <div class="manga-card" *ngFor="let f of favoritos" (click)="abrirManga(f.id)"
          title="{{ f.nome || 'Sem tÃ­tulo' }}">
          <img [src]="f.capa ? (API_BASE + f.capa) : 'assets/placeholder.png'" alt="{{ f.nome || 'Capa' }}" />
          <p>{{ f.nome || 'Sem tÃ­tulo' }}</p>
        </div>

        <p *ngIf="erroFavoritos" style="color:#fff">FaÃ§a login para ver seus favoritos ou nÃ£o hÃ¡ favoritos ainda.</p>
        <p *ngIf="!erroFavoritos && favoritos?.length === 0" style="color:#fff">VocÃª ainda nÃ£o favoritou nenhuma obra.
        </p>
      </div>

      <button class="seta seta-direita" (click)="rolar('favoritos', 1)">&#10095;</button>
    </div>
  </section>

  <footer>Â© 2025 Toon Archive - Todos os direitos reservados.</footer>

  <!-- Modal de confirmaÃ§Ã£o de logout -->
  <div id="logoutModal" class="logout-modal" [class.ativo]="logoutAtivo">
    <div class="logout-content">
      <p>Deseja sair?</p>
      <div class="logout-buttons">
        <button id="confirmLogout" class="btn-ok" (click)="confirmarLogout()">Sim</button>
        <button id="cancelLogout" class="btn-cancel" (click)="cancelarLogout()">Cancelar</button>
      </div>
    </div>
  </div>
</div>