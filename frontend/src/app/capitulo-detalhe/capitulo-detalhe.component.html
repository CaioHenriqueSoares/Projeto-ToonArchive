<header class="ta-header">
  <a routerLink="/home">
    <img src="assets/logo.png" alt="Toon Archive" class="ta-logo">
  </a>
</header>

<main class="ta-main">

  <ng-container *ngIf="isLoading; else capituloContent">
    <p class="empty-text" style="text-align: center;">Carregando cap√≠tulo...</p>
  </ng-container>

  <ng-template #capituloContent>

    <div *ngIf="capitulo" class="chapter-info">
      <div class="chapter-nav">

        <button class="nav-btn" (click)="capituloAnterior()" [disabled]="!capitulo || !capitulo.capituloAnteriorId">
          &#9664; Cap√≠tulo Anterior
        </button>

        <button class="nav-btn" (click)="voltarManga()">
          Voltar para o mang√°
        </button>

        <button class="nav-btn" (click)="proximoCapitulo()" [disabled]="!capitulo || !capitulo.proximoCapituloId">
          Pr√≥ximo Cap√≠tulo &#9654;
        </button>

      </div>
      <h2 class="chapter-header">
        <span class="chapter-number">Cap. {{ capitulo.numero }}</span>
        <span class="chapter-title">{{ capitulo.tituloCapitulo }}</span>
      </h2>
    </div>

    <section class="page-reader-container">

      <div class="page-nav-controls">
        <button class="page-nav-btn" (click)="paginaAnterior()">
          &#9664; Anterior
        </button>
        <span class="page-counter">
          P√°gina {{ paginaAtualIndex + 1 }} / {{ paginas.length }}
        </span>
        <button class="page-nav-btn" (click)="proximaPagina()">
          Pr√≥xima &#9654;
        </button>
      </div>

      <div class="pagina-wrapper">
        <img *ngIf="paginaAtual" [src]="paginaAtual.url" [alt]="'P√°gina ' + paginaAtual.ordem" class="pagina-imagem" />
        <p *ngIf="!paginaAtual" class="empty-text">Erro ao carregar a p√°gina.</p>
      </div>

    </section>

    <section id="comentarios-container">
      <h2>Coment√°rios</h2>

      <form *ngIf="usuarioAtual" (ngSubmit)="enviarComentario()" class="comentario-form">
        <textarea [(ngModel)]="comentarioTexto" name="comentarioTexto" placeholder="Escreva seu coment√°rio aqui..."
          required></textarea>
        <button type="submit" [disabled]="!comentarioTexto.trim()">Enviar Coment√°rio</button>
      </form>

      <p *ngIf="!usuarioAtual" class="login-msg">
        Fa√ßa login para poder comentar neste cap√≠tulo.
      </p>

      <ng-container *ngIf="comentariosCarregados; else carregandoComentarios">
        <div *ngIf="comentarios.length === 0" class="empty-text">Nenhum coment√°rio ainda. Seja o primeiro!</div>

        <div *ngFor="let c of comentarios" class="comentario-item">
          <div class="comentario-header">
            <strong class="comentario-autor">{{ c.autor }}</strong>
            <span class="comentario-data">
              {{ c.dataHora | date:'short' }}
            </span>
          </div>

          <div class="comentario-actions"
            *ngIf="usuarioAtual && (c.autor === usuarioAtual || isAdmin) && !c.emEdicao && !c.confirmandoExclusao">
            <button (click)="iniciarEdicao(c)">‚úèÔ∏è Editar</button>
            <button (click)="pedirConfirmacaoExclusao(c)">üóëÔ∏è Excluir</button>
          </div>

          <p *ngIf="!c.emEdicao" class="comentario-texto">{{ c.texto }}</p>

          <div *ngIf="c.emEdicao" class="comentario-edicao">
            <textarea [(ngModel)]="c.texto" name="edicaoTexto" required></textarea>

            <div class="edicao-botoes">
              <button type="button" class="comentario-salvar-btn" (click)="salvarEdicao(c)">
                üíæ Salvar
              </button>

              <button type="button" class="comentario-cancelar-btn" (click)="cancelarEdicao(c)">
                ‚ùå Cancelar
              </button>
            </div>
          </div>

          <div *ngIf="c.confirmandoExclusao" class="confirmacao-exclusao">
            <p>Tem certeza que deseja excluir este coment√°rio?</p>
            <button type="button" class="comentario-salvar-btn" (click)="excluirComentario(c)">üóëÔ∏è Excluir</button>
            <button type="button" class="comentario-cancelar-btn" (click)="cancelarExclusao(c)">‚ùå Cancelar</button>
          </div>
        </div>
      </ng-container>

      <ng-template #carregandoComentarios>
        <p class="empty-text">Carregando coment√°rios...</p>
      </ng-template>

    </section>
  </ng-template>
</main>