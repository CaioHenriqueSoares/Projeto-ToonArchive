<header class="ta-header">
  <a routerLink="/home">
    <img src="assets/logo.png" alt="Toon Archive" class="ta-logo">
  </a>
</header>

<main class="ta-main">

  <!-- CARD DO MANGÃ -->
  <ng-container *ngIf="manga; else carregandoManga">
    <section class="manga-card">
      <div class="cover-container">
        <img class="manga-cover" [src]="API + manga.capa" [alt]="'Capa de ' + manga.nome">

        <!-- botÃ£o estrela sobreposto (top-right) -->
        <button class="star-btn" (click)="onToggleFavorito()" [class.active]="isFav" [disabled]="favoritoLoading"
          [attr.aria-pressed]="isFav" title="{{ isFav ? 'Remover dos favoritos' : 'Adicionar aos favoritos' }}">
          <span class="star-char">â˜…</span>
        </button>
      </div>

      <div class="manga-info">
        <h2 class="manga-title">{{ manga.nome }}</h2>

        <p class="manga-meta"><strong>Autor:</strong> {{ manga.autor }} <span *ngIf="isAuthor"
            class="tag-autor">(VocÃª)</span></p>
        <p class="manga-meta"><strong>Editora:</strong> {{ manga.editora || '-' }}</p>
        <p class="manga-meta"><strong>Ano:</strong> {{ manga.ano || '-' }}</p>

        <p class="manga-description">
          {{ manga.descricao }}
        </p>

        <button class="manage-btn" *ngIf="isAdmin || isAuthor" (click)="irParaGerenciarCapitulos()">
          âš™ Gerenciar CapÃ­tulos
        </button>
      </div>
    </section>

  </ng-container>

  <ng-template #carregandoManga>
    <h2 class="loading-title">Carregando mangÃ¡...</h2>
  </ng-template>

  <!-- CARD DE CAPÃTULOS -->
  <section class="chapter-card">
    <h3>CapÃ­tulos:</h3>

    <div *ngIf="capitulos?.length; else semCapitulos">
      <div class="chapter-row" *ngFor="let cap of capitulos">
        <span class="chapter-title">
          CapÃ­tulo {{ cap.numero }} - {{ cap.tituloCapitulo }}
        </span>
        <button class="read-btn" [routerLink]="['/capitulo-detalhe']" [queryParams]="{ id: cap.id }">
          ğŸ“ Ler
        </button>
      </div>
    </div>

    <ng-template #semCapitulos>
      <p class="empty-text">NÃ£o hÃ¡ capÃ­tulos cadastrados ainda.</p>
    </ng-template>
  </section>

  <!-- CARD DE COMENTÃRIOS -->
  <section class="comments-card">
    <h3>ComentÃ¡rios</h3>

    <!-- ITEM DO COMENTÃRIO -->
    <div class="comentario-item" *ngFor="let c of comentarios">
      <div class="comentario-header">
        <span class="autor">{{ c.autor }}</span>

        <!-- BOTÃ•ES DE EDITAR / EXCLUIR -->
        <div class="comentario-acoes" *ngIf="podeGerirComentario(c)">
          <!-- iniciar ediÃ§Ã£o -->
          <button type="button" class="acao editar" *ngIf="!c.emEdicao && !c.confirmandoExclusao"
            (click)="iniciarEdicao(c)">âœï¸</button>

          <!-- iniciar confirmaÃ§Ã£o de exclusÃ£o -->
          <button type="button" class="acao excluir" *ngIf="!c.emEdicao && !c.confirmandoExclusao"
            (click)="pedirConfirmacaoExclusao(c)">ğŸ—‘ï¸</button>
        </div>
      </div>

      <!-- MODO NORMAL (mostrar texto) -->
      <div class="comentario-texto" *ngIf="!c.emEdicao && !c.confirmandoExclusao">
        {{ c.texto }}
      </div>

      <!-- MODO EDIÃ‡ÃƒO -->
      <div *ngIf="c.emEdicao" style="margin-top:8px;">
        <textarea class="comentario-editar-area" [(ngModel)]="c.textoEditado" name="textoEditado_{{c.id}}">
    </textarea>

        <div style="margin-top:8px; display:flex; gap:8px;">
          <button type="button" class="comentario-salvar-btn" (click)="salvarEdicao(c)" [disabled]="c.saving">
            {{ c.saving ? 'Salvandoâ€¦' : 'ğŸ’¾ Salvar' }}
          </button>

          <button type="button" class="comentario-cancelar-btn" (click)="cancelarEdicao(c)" [disabled]="c.saving">
            âŒ Cancelar
          </button>
        </div>
      </div>

      <!-- CONFIRMAÃ‡ÃƒO DE EXCLUSÃƒO -->
      <div *ngIf="c.confirmandoExclusao" style="margin-top:8px; text-align:center;">
        <button type="button" class="comentario-salvar-btn" (click)="confirmarExclusao(c)">ğŸ—‘ï¸ Excluir</button>
        <button type="button" class="comentario-cancelar-btn" (click)="cancelarExclusao(c)">âŒ Cancelar</button>
      </div>

      <!-- DATA -->
      <span class="comentario-data">
        {{ c.dataHora | date:'short' }}
      </span>
    </div>

    <ng-template #carregandoComentarios>
      <p class="empty-text">Carregando comentÃ¡rios...</p>
    </ng-template>

    <!-- FORM -->
    <form (ngSubmit)="enviarComentario()" class="comment-form">
      <textarea [(ngModel)]="comentarioTexto" name="comentarioTexto" placeholder="Escreva um comentÃ¡rio..." required>
    </textarea>
      <button type="submit" class="comment-submit">Enviar</button>
    </form>
  </section>



</main>

<footer class="ta-footer">
  Â© 2025 Toon Archive - Todos os direitos reservados.
</footer>