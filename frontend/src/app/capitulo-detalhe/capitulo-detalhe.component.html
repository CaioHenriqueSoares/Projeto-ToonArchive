<header class="ta-header">
  <a routerLink="/home">
    <img src="assets/logo.png" alt="Toon Archive" class="ta-logo">
  </a>
</header>

<main class="ta-main">

  <ng-container *ngIf="isLoading; else capituloContent">
    <p class="empty-text" style="text-align: center;">Carregando cap√≠tulo...</p>
  </ng-container>

  <ng-template #capituloContent>

    <div *ngIf="capitulo" class="chapter-info">
      <div class="chapter-nav">

        <button class="nav-btn" (click)="capituloAnterior()" [disabled]="!capitulo || !capitulo.capituloAnteriorId">
          &#9664; Cap√≠tulo Anterior
        </button>

        <button class="nav-btn" (click)="voltarManga()">
          Voltar para o mang√°
        </button>

        <button class="nav-btn" (click)="proximoCapitulo()" [disabled]="!capitulo || !capitulo.proximoCapituloId">
          Pr√≥ximo Cap√≠tulo &#9654;
        </button>

      </div>

      <h2 class="chapter-header">
        <span class="chapter-number">Cap. {{ capitulo.numero }}</span>
        <span class="chapter-title">{{ capitulo.tituloCapitulo }}</span>
      </h2>
    </div>

    <section class="page-reader-container">

      <div class="page-nav-controls">
        <button class="page-nav-btn" (click)="paginaAnterior()">
          &#9664; Anterior
        </button>

        <span class="page-counter">
          P√°gina {{ paginaAtualIndex + 1 }} / {{ paginas.length }}
        </span>

        <button class="page-nav-btn" (click)="proximaPagina()">
          Pr√≥xima &#9654;
        </button>
      </div>

      <div class="pagina-wrapper">
        <img *ngIf="paginaAtual"
             [src]="paginaAtual.url"
             [alt]="'P√°gina ' + paginaAtual.ordem"
             class="pagina-imagem" />
        <p *ngIf="!paginaAtual" class="empty-text">Erro ao carregar a p√°gina.</p>
      </div>

    </section>

    <!-- CARD DE COMENT√ÅRIOS -->
  <section class="comments-card">
    <h3>Coment√°rios</h3>

    <!-- ITEM DO COMENT√ÅRIO -->
    <div class="comentario-item" *ngFor="let c of comentarios">
      <div class="comentario-header">
        <span class="autor">{{ c.autor }}</span>

        <!-- BOT√ïES DE EDITAR / EXCLUIR -->
        <div class="comentario-acoes" *ngIf="podeGerirComentario(c)">
          <!-- iniciar edi√ß√£o -->
          <button type="button" class="acao editar" *ngIf="!c.emEdicao && !c.confirmandoExclusao"
            (click)="iniciarEdicao(c)">‚úèÔ∏è</button>

          <!-- iniciar confirma√ß√£o de exclus√£o -->
          <button type="button" class="acao excluir" *ngIf="!c.emEdicao && !c.confirmandoExclusao"
            (click)="pedirConfirmacaoExclusao(c)">üóëÔ∏è</button>
        </div>
      </div>

      <!-- MODO NORMAL (mostrar texto) -->
      <div class="comentario-texto" *ngIf="!c.emEdicao && !c.confirmandoExclusao">
        {{ c.texto }}
      </div>

      <!-- MODO EDI√á√ÉO -->
      <div *ngIf="c.emEdicao" style="margin-top:8px;">
        <textarea class="comentario-editar-area" [(ngModel)]="c.textoEditado" name="textoEditado_{{c.id}}">
    </textarea>

        <div style="margin-top:8px; display:flex; gap:8px;">
          <button type="button" class="comentario-salvar-btn" (click)="salvarEdicao(c)" [disabled]="c.saving">
            {{ c.saving ? 'Salvando‚Ä¶' : 'üíæ Salvar' }}
          </button>

          <button type="button" class="comentario-cancelar-btn" (click)="cancelarEdicao(c)" [disabled]="c.saving">
            ‚ùå Cancelar
          </button>
        </div>
      </div>

      <!-- CONFIRMA√á√ÉO DE EXCLUS√ÉO -->
      <div *ngIf="c.confirmandoExclusao" style="margin-top:8px; text-align:center;">
        <button type="button" class="comentario-salvar-btn" (click)="confirmarExclusao(c)">üóëÔ∏è Excluir</button>
        <button type="button" class="comentario-cancelar-btn" (click)="cancelarExclusao(c)">‚ùå Cancelar</button>
      </div>

      <!-- DATA -->
      <span class="comentario-data">
        {{ c.dataHora | date:'short' }}
      </span>
    </div>

    <ng-template #carregandoComentarios>
      <p class="empty-text">Carregando coment√°rios...</p>
    </ng-template>

    <!-- FORM -->
    <form (ngSubmit)="enviarComentario()" class="comment-form">
      <textarea [(ngModel)]="comentarioTexto" name="comentarioTexto" placeholder="Escreva um coment√°rio..." required>
    </textarea>
      <button type="submit" class="comment-submit">Enviar</button>
    </form>
  </section>

  </ng-template>
</main>
